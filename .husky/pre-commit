TODAY=$(date +%Y-%m-%d)
BLOG_DIR="apps/blog/src/data/blog"

# New (untracked/added) .md files — add pubDatetime if missing
NEW_FILES=$(git diff --cached --name-only --diff-filter=A -- "$BLOG_DIR/*.md")
for file in $NEW_FILES; do
  if [ -f "$file" ]; then
    if ! grep -q "^pubDatetime:" "$file"; then
      # Insert pubDatetime after the first ---
      sed -i "0,/^---$/{ /^---$/a pubDatetime: $TODAY
      }" "$file"
      git add "$file"
    fi
  fi
done

# Modified (tracked) .md files — add or update modDatetime
MODIFIED_FILES=$(git diff --cached --name-only --diff-filter=M -- "$BLOG_DIR/*.md")
for file in $MODIFIED_FILES; do
  if [ -f "$file" ]; then
    if grep -q "^modDatetime:" "$file"; then
      # Update existing modDatetime
      sed -i "s/^modDatetime:.*$/modDatetime: $TODAY/" "$file"
    else
      # Add modDatetime after pubDatetime
      sed -i "/^pubDatetime:/a modDatetime: $TODAY" "$file"
    fi
    git add "$file"
  fi
done
